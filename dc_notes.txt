server:
    build: 
      context: ./server
      secrets:
        - "PG_URL"
        - "GOOGLE_CLIENT_ID"
        - "GOOGLE_CLIENT_SECRET"
        - "GOOGLE_CALLBACK_URL"
        - "GOOGLE_OAUTH_URL"
        - "GOOGLE_ACCESS_TOKEN_URL"
        - "GOOGLE_TOKEN_INFO_URL"
        - "PORT"
        - "CLIENT_URL"
        - "SESSION_SECRET"
        - "CSRF_SECRET"

    ports:
      - "8000:8000"   # Express default port
    volumes:
      - ./server:/app  # Live code sync
      - /app/node_modules
    command: sh -c "npm install && npm run dev"
    env_file:
      - ./server/.env
    secrets: 
      PG_URL:
        environment: "PG_URL"
      GOOGLE_CLIENT_ID:
        environment: "GOOGLE_CLIENT_ID"
      GOOGLE_CLIENT_SECRET:
        environment: "GOOGLE_CLIENT_SECRET"
      GOOGLE_CALLBACK_URL:
        environment: "GOOGLE_CALLBACK_URL"
      GOOGLE_OAUTH_URL:
        environment: "GOOGLE_OAUTH_URL"
      GOOGLE_ACCESS_TOKEN_URL:
        environment: "GOOGLE_ACCESS_TOKEN_URL"
      GOOGLE_TOKEN_INFO_URL:
        environment: "GOOGLE_TOKEN_INFO_URL"
      PORT:
        environment: "PORT"
      CLIENT_URL:
        environment: "CLIENT_URL"
      SESSION_SECRET:
        environment: "SESSION_SECRET"
      CSRF_SECRET:
        environment: "CSRF_SECRET"
  


    environment:
      - NODE_ENV=development

    


